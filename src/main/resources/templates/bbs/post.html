<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!-- 共通 <head> 読込 -->
<head th:replace="fragment/head-fragment :: head-fragment(
title = ${postData != null} ? ${postData.title} : #{postNone}, scripts = ~{::script}, links = ~{::link})">
	<!-- 個別CSS、JSを引数に指定 -->
	<link rel="stylesheet" type="text/css" th:href="@{/css/post.css}">
	<script type="text/javascript" th:src="@{/js/rest/rest-posts.js}" defer></script>
	<script type="text/javascript" th:src="@{/js/rest/rest-comments.js}" defer></script>
	<script type="text/javascript" th:src="@{/js/bbs/viewpost.js}" defer></script>
</head>
<body>

<!-- 共通ヘッダー読込 -->
<header th:replace="fragment/header-fragment :: header-fragment"></header>

<div class="container mt-3">
	<!-- 投稿データが見つからない時 -->
	<th:block th:if="${postData == null}">
		<h3 class="text-danger text-center" th:text="#{postNone}"></h3>
		<div class="text-center">
			<a href="javascript:history.back();" th:text="#{back.prev}"></a>
		</div>
	</th:block>
	<!-- 投稿データを取得できた時 -->
	<th:block th:if="${postData != null}">
		<!-- 投稿タイトル部分 -->
		<div class="container w-100">
			<div class="row bg-info rounded p-2">
				<div class="col-2 bg-light text-dark rounded d-flex align-items-center justify-content-center"
					th:text="${postData.category}"></div>
				<h3 class="col-10 text-white" th:text="${postData.title}"></h3>
			</div>
		</div>
		<!-- 投稿詳細部分 -->
		<div class="w-100 border border-info rounded mt-2">
			<div class="p-2">
				<small th:text="#{updateDate} + '：' + ${#dates.format(postData.updateDate, 'yyyy/MM/dd HH:mm')}"></small>
				<h5 th:text="#{poster} + '：' + ${postData.creatorName}"></h5>
				<div class="p-2 border border-info rounded">
					<p th:text="${postData.comment}"></p>
				</div>
				<div class="d-flex flex-row mt-2">
					<!-- 開く -->
					<a th:href="'/calculator?openBBS=' + ${postData.id}" class="btn btn-info mr-3">
						<i class="fas fa-download"></i>&ensp;[[#{open}]]
					</a>
					<div sec:authorize="${authenticated}" class="d-flex flex-nowrap">
						<th:block th:if="${#authentication.principal.loginUser.id == postData.creatorId}">
							<!-- 投稿者本人の場合可能な操作 -->
							<!-- 投稿内容編集 -->
							<a th:href="'/bbs/post/update?postId=' + ${postData.id}" class="mr-3 btn btn-success" role="button">
								<i class="fas fa-edit"></i>&ensp;[[#{postEditing}]]
							</a>
							<!-- 投稿を削除 -->
							<button type="button" class="btn btn-danger" id="delete-btn" th:onclick="'ajaxDeletePost(' + ${postData.id} + ');'">
								<i class='fas fa-trash-alt'></i>&ensp;[[#{postDelete}]]
							</button>
						</th:block>
					</div>
				</div>
			</div>
		</div>
		<div class="w-100 border border-secondary rounded mt-3 p-2">
			コメント
			<th:block th:if="${commentList.size() != 0}" th:each="comment : ${commentList}">
				<div class="m-1 border border-secondary rounded">
					<small class="p-1">[[${comment.no}]]　投稿者：[[${comment.posterName}]]　　投稿日時：[[${#dates.format(comment.postDate, 'yyyy/MM/dd HH:mm')}]]</small><br>
					<div class="p-1 border-top border-secondary">
						<p>[[${comment.comment}]]</p>
					</div>
				</div>
			</th:block>
			<th:block th:if="${commentList.size() == 0}">
				<div>-- コメントはまだありません --</div>
			</th:block>
		</div>
		<div class="w-100 border border-secondary rounded mt-3 p-2">
			コメント投稿
			<div sec:authorize="${authenticated}">
				<form id="comment-form" th:action method="post" onsubmit="return ajaxAddComment();">
					<div>
						<textarea class="mt-2 mb-2 form-control"></textarea>
					</div>
					<button type="submit" class="btn btn-primary">投稿</button>
				</form>
			</div>
			<div sec:authorize="${!authenticated}">
				-- ログインするとコメントが出来るようになります --
			</div>
		</div>
	</th:block>
</div>

</body>
</html>